function t(t,e=0){if(0===e)return t;let i=void 0;return function(...s){i&&clearTimeout(i),i=setTimeout((function(){t(...s)}),e||300)}}function e(t,e=0){let i=void 0;return function(...s){i||(i=setTimeout((function(){t(...s),i=null}),e||300))}}function i(t,e){Object.keys(t).forEach((i,s)=>{e(i,t[i],s)})}function s(t,e){return Object.keys(t).map((i,s)=>e(i,t[i],s))}function r(t){return null==t}function o(t){return!1===r(t)}function n(t){return Array.isArray(t)}function l(t){return"boolean"==typeof t}function a(t){return"string"==typeof t}function h(t){return!1===a(t)}function d(t){return"object"==typeof t&&!n(t)&&!u(t)&&!a(t)&&null!==t}function c(t){return"function"==typeof t}function u(t){return"number"==typeof t}function v(t){return JSON.parse(JSON.stringify(t))}const p={image:!0,input:!0,br:!0,path:!0,line:!0,circle:!0,rect:!0,polygon:!0,polyline:!0,use:!0},f=(t,...e)=>{var i=t.map((t,i)=>{var s=e[i]||"";return c(s)&&(s=s()),n(s)||(s=[s]),t+(s=s.join(""))}).join("");return i=i.replace(/\<(\w*)([^\>]*)\/\>/gim,(function(t,e){return p[e.toLowerCase()]?t:t.replace("/>",`></${e}>`)}))},m=/[xy]/g;function g(){var t=(new Date).getTime();return"xxx12-xx-34xx".replace(m,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))}function y(){var t=(new Date).getTime();return"idxxxxxxx".replace(m,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))}const b=(t,e=S)=>` ${e} ${t}`,C=/^dom (.*)/gi,x=/^load (.*)/gi,E=/^bind (.*)/gi,M=":",S="|",k="dom ",w="load ",$="bind ",N=" ",T={},L=(...t)=>{var e=t.join(":");return(...t)=>"dom "+[e,...t].join(" ")},A=L,O=L,P=A("click"),_=A("dblclick"),B=A("mousedown"),D=A("mouseup"),K=A("mousemove"),j=A("mouseover"),F=A("mouseout"),z=A("mouseenter"),R=A("mouseleave"),H=A("touchstart"),I=A("touchmove"),X=A("touchend"),q=A("keydown"),V=A("keyup"),U=A("keypress"),G=A("drag"),Y=A("dragstart"),W=A("drop"),J=A("dragover"),Q=A("dragenter"),Z=A("dragleave"),tt=A("dragexit"),et=A("dragout"),it=A("dragend"),st=A("contextmenu"),rt=A("change"),ot=A("input"),nt=A("focus"),lt=A("focusin"),at=A("focusout"),ht=A("blur"),dt=A("paste"),ct=A("resize"),ut=A("scroll"),vt=A("submit"),pt=O("pointerdown"),ft=O("pointermove"),mt=O("pointerup"),gt=O("change","input"),yt=O("wheel","mousewheel","DOMMouseScroll"),bt=A("animationstart"),Ct=A("animationend"),xt=A("animationiteration"),Et=A("transitionstart"),Mt=A("transitionend"),St=A("transitionrun"),kt=A("transitioncancel"),wt=(t,e=S)=>b(t,e),$t=(t,e=S)=>b(`after(${t})`,e),Nt=(t,e=S)=>b(`before(${t})`,e),Tt=wt,Lt=wt,At=Tt("ArrowUp"),Ot=Tt("ArrowDown"),Pt=Tt("ArrowLeft"),_t=Tt("ArrowRight"),Bt=Tt("Enter"),Dt=Tt("Space"),Kt=Tt("Escape"),jt=Tt("isAltKey"),Ft=Tt("isShiftKey"),zt=Tt("isMetaKey"),Rt=Tt("isCtrlKey"),Ht=Tt("self"),It=Tt("fit"),Xt=Tt("passive"),qt=Tt("vdom"),Vt=(t=100)=>Tt(`debounce(${t})`),Ut=Vt(1e3),Gt=(t=100)=>Tt(`throttle(${t})`),Yt=Tt("capture()"),Wt=(t="move")=>$t("bodyMouseMove "+t),Jt=(t="end")=>$t("bodyMouseUp "+t),Qt=$t("preventDefault"),Zt=$t("stopPropagation"),te=(t="$el")=>"load "+t,ee=t=>{if(!1===Boolean(t))return"";var e=g();return T[e]=t,e},ie=t=>T[t]||"",se=()=>!0,re=(t="$el",e="")=>"bind "+t+(e?S+ee(e):"");function oe(t,e,i,s=!1){t&&t.addEventListener(e,i,s)}function ne(t,e,i){t&&i&&t.removeEventListener(e,i)}function le(t){if(t instanceof TouchEvent&&t.touches&&t.touches[0]){const{pageX:e,pageY:i}=t.touches[0];return{pageX:e,pageY:i}}const{pageX:e,pageY:i}=t;return{pageX:e,pageY:i}}function ae(t){var{pageX:e,pageY:i}=le(t);return{x:e,y:i}}class he{constructor(t={}){this.source="",this.sourceContext={},this.cachedCallback={},this.callbacks={},this.cachedCallback={},this.callbacks={}}getCallbacks(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}setCallbacks(t,e=[]){this.callbacks[t]=e}on(e,i,s,r=0){var o=r>0?t(i,r):i;this.getCallbacks(e).push({event:e,callback:o,context:s,originalCallback:i})}off(t,e){1==arguments.length?this.setCallbacks(t):2==arguments.length&&this.setCallbacks(t,this.getCallbacks(t).filter(t=>t.originalCallback!==e))}offAll(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(e=>e.context!==t))})}getCachedCallbacks(t){return this.getCallbacks(t)}sendMessage(t,e,...i){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);s&&s.filter(e=>e.originalCallback.source!==t).forEach(t=>{t.callback(...i)})})}triggerMessage(t,e,...i){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);s?s.filter(e=>e.originalCallback.source===t).forEach(t=>{t.callback(...i)}):console.warn(e," is not valid event")})}emit(t,...e){this.sendMessage(this.source,t,...e)}trigger(t,...e){this.triggerMessage(this.source,t,...e)}}const de={constructor:!0,initState:!0,refresh:!0,updateData:!0,initializeProperty:!0,created:!0,getRealEventName:!0,initializeStoreEvent:!0,destoryStoreEvent:!0,destroy:!0,emit:!0,trigger:!0,on:!0,off:!0,setState:!0,_reload:!0,render:!0,initialize:!0,afterRender:!0,components:!0,getRef:!0,parseTemplate:!0,childrenIds:!0,exists:!0,parseProperty:!0,parseSourceName:!0,parseComponent:!0,clean:!0,template:!0,eachChildren:!0,initializeEvent:!0,self:!0,isAltKey:!0,isCtrlKey:!0,isShiftKey:!0,isMetaKey:!0,preventDefault:!0,stopPropagation:!0,bodyMouseMove:!0,bodyMouseUp:!0};class ce{constructor(t,e={}){this.context=void 0,this.options={},this.context=t,this.options=e}initialize(){}load(){}refresh(){}render(){}getRef(t){var e;return null===(e=this.context)||void 0===e?void 0:e.getRef(t)}splitMethodByKeyword(t,e){var i=t.filter(t=>t.indexOf(e+"(")>-1),s=i.map(t=>{var[i,s]=t.split(e+"(")[1].split(")")[0].trim().split(" ");return{target:i,param:s}});return[i,s]}collectProps(){var t=this.context,e=null==t?void 0:t.getMethod("__proto__"),i=[];do{if(!1===e instanceof Object)break;const s=Object.getOwnPropertyNames(e).filter(e=>t&&c(t.getMethod(e))&&!de[e]);i.push(...s),e=e.__proto__}while(e);return i}filterProps(t){return this.collectProps().filter(e=>e.match(t))}run(){}destroy(){}}function ue(t){let e={};return Object.keys(t).forEach(i=>{const s=t[i];e[s.name]=s.value}),e}function ve(t,e,i){if(e)if(i){if(r=e,(s=i).nodeType===Node.TEXT_NODE&&s!==r||s.nodeName!==r.nodeName)t.replaceChild(i.cloneNode(!0),e);else if(i.nodeType!==Node.TEXT_NODE){((t,e={},i={})=>{const s=Object.assign(Object.assign({},e),i);Object.keys(s).forEach(s=>{((t,e,i,s)=>{i?s&&i===s||((t,e,i)=>{"boolean"==typeof i?((t,e,i)=>{i?(t.setAttribute(e,e),t[e]=i):(t.removeAttribute(e),t[e]=i)})(t,e,i):t.setAttribute(e,i)})(t,e,i):((t,e,i)=>{"boolean"==typeof i?((t,e)=>{t.removeAttribute(e),t[e]=!1})(t,e):e&&((t,e)=>{t.removeAttribute(e)})(t,e)})(t,e,s)})(t,s,e[s],i[s])})})(e,ue(i.attributes),ue(e.attributes));let t=pe(e),s=pe(i);const r=Math.max(t.length,s.length);for(let i=0;i<r;i++)ve(e,t[i],s[i])}}else t.removeChild(e);else t.appendChild(i.cloneNode(!0));var s,r}const pe=t=>{let e=t.firstChild;if(!e)return[];let i=[];do{i.push(e),e=e.nextSibling}while(e);return i};function fe(t,e){t=t.el||t,e=e.el||e;for(var i=pe(t),s=pe(e),r=Math.max(i.length,s.length),o=0;o<r;o++)ve(t,i[o],s[o])}class me{constructor(t,e="",s={}){if(this.el=void 0,t instanceof HTMLElement)this.el=t;else{var r=document.createElement(t);e&&(r.className=e),i(s=s||{},(t,e)=>{r.setAttribute(t,e)}),this.el=r}}static create(t,e,i){return new me(t,e,i)}static createByHTML(t){var e=me.create("div").html(t).children();return e.length?me.create(e[0].el):null}static createFragment(t){var e=me.create("div");return e.html(t),me.create(e.el||"div").createChildrenFragment()}static getScrollTop(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}static getScrollLeft(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}static parse(t){return(new DOMParser).parseFromString(t,"text/html")}static body(){return me.create(document.body)}isFragment(){var t;return 11===(null===(t=this.el)||void 0===t?void 0:t.nodeType)}setAttr(t){if(!this.isFragment())return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}attr(t,e){var i,s,r;if(!this.isFragment())return 1==arguments.length?(null===(i=this.el)||void 0===i?void 0:i.getAttribute)?null===(s=this.el)||void 0===s?void 0:s.getAttribute(t):void 0:(null===(r=this.el)||void 0===r||r.setAttribute(t,e),this)}attrKeyValue(t){var e;return this.isFragment()?{}:{[(null===(e=this.el)||void 0===e?void 0:e.getAttribute(t))||""]:this.val()}}attrs(...t){return this.isFragment()?[]:t.map(t=>{var e;return null===(e=this.el)||void 0===e?void 0:e.getAttribute(t)})}styles(...t){return t.map(t=>{var e;return(null===(e=this.el)||void 0===e?void 0:e.style)[t]})}removeAttr(t){var e;return null===(e=this.el)||void 0===e||e.removeAttribute(t),this}removeStyle(t){var e;return null===(e=this.el)||void 0===e||e.style.removeProperty(t),this}is(t){return this.el===(t.el||t)}isTag(t){var e;return(null===(e=this.el)||void 0===e?void 0:e.tagName.toLowerCase())===t.toLowerCase()}closest(t){var e;let i=this,s=!1;for(;!(s=i.hasClass(t));){if(!(null===(e=i.el)||void 0===e?void 0:e.parentNode))return null;i=me.create(i.el.parentNode)}return s?i:null}parent(){var t;return me.create(null===(t=this.el)||void 0===t?void 0:t.parentNode)}hasParent(){var t;return!!(null===(t=this.el)||void 0===t?void 0:t.parentNode)}removeClass(...t){var e;return null===(e=this.el)||void 0===e||e.classList.remove(...t),this}hasClass(t){var e,i;return!!(null===(e=this.el)||void 0===e?void 0:e.classList)&&(null===(i=this.el)||void 0===i?void 0:i.classList.contains(t))}addClass(...t){var e;return null===(e=this.el)||void 0===e||e.classList.add(...t),this}onlyOneClass(t){this.parent().children().forEach(e=>{e.removeClass(t)}),this.addClass(t)}toggleClass(t,e){var i;null===(i=this.el)||void 0===i||i.classList.toggle(t,e)}html(t){var e;return r(t)?null===(e=this.el)||void 0===e?void 0:e.innerHTML:(a(t)&&this.el?this.el.innerHTML=t:this.empty().append(t),this)}htmlDiff(t){fe(this,t)}updateDiff(t,e="div"){fe(this,me.create(e).html(t))}updateSVGDiff(t,e="div"){fe(this,me.create(e).html(`<svg>${t}</svg>`).firstChild)}find(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelector(t)}$(t){var e=this.find(t);return e?me.create(e):void 0}findAll(t){var e;return null===(e=this.el)||void 0===e?void 0:e.querySelectorAll(t)}$$(t){return[...this.findAll(t)||[]].map(t=>me.create(t))}empty(){for(var t,e,i;null===(t=this.el)||void 0===t?void 0:t.firstChild;)null===(e=this.el)||void 0===e||e.removeChild(null===(i=this.el)||void 0===i?void 0:i.firstChild);return this}append(t){var e,i,s,r;return a(t)?null===(e=this.el)||void 0===e||e.appendChild(document.createTextNode(t)):t instanceof me&&t.el?null===(i=this.el)||void 0===i||i.appendChild(t.el):t instanceof DocumentFragment?null===(s=this.el)||void 0===s||s.appendChild(t):t instanceof HTMLElement&&(null===(r=this.el)||void 0===r||r.appendChild(t)),this}prepend(t){var e,i,s;return a(t)?null===(e=this.el)||void 0===e||e.prepend(document.createTextNode(t)):t instanceof me&&t.el?null===(i=this.el)||void 0===i||i.prepend(t.el):null===(s=this.el)||void 0===s||s.prepend(t),this}prependHTML(t){var e=me.create("div").html(t);return this.prepend(e.createChildrenFragment()),e}appendHTML(t){var e=me.create("div").html(t);return this.append(e.createChildrenFragment()),e}createChildrenFragment(){const t=this.children();var e=document.createDocumentFragment();return t.forEach(t=>e.appendChild(t.el)),e}appendTo(t){const e=t instanceof me?t.el:t;return null==e||e.appendChild(this.el),this}remove(){var t,e;return(null===(t=this.el)||void 0===t?void 0:t.parentNode)&&(null===(e=this.el)||void 0===e||e.parentNode.removeChild(this.el)),this}removeChild(t){var e;const i=t instanceof me?t.el:t;return null===(e=this.el)||void 0===e||e.removeChild(i),this}text(t){var e;if(r(t))return null===(e=this.el)||void 0===e?void 0:e.textContent;var i=t;return t instanceof me&&(i=t.text()),this.el&&(this.el.textContent=i),this}css(t,e){var i,s;if(2===arguments.length)Object.assign(null===(i=this.el)||void 0===i?void 0:i.style,{[t]:e});else if(o(t)){if(a(t)){return getComputedStyle(this.el)[t]}Object.assign(null===(s=this.el)||void 0===s?void 0:s.style,t)}return this}getComputedStyle(...t){const e=getComputedStyle(this.el);let i={};return t.forEach(t=>{i[t]=e[t]}),i}getStyleList(...t){var e,i,s;let r={};const o=(null===(e=this.el)||void 0===e?void 0:e.style.length)||0;for(var n=0;n<o;n++){var l=null===(i=this.el)||void 0===i?void 0:i.style[n];r[l]=(null===(s=this.el)||void 0===s?void 0:s.style)[l]}return t.forEach(t=>{r[t]=this.css(t)}),r}cssText(t){var e;return r(t)?null===(e=this.el)||void 0===e?void 0:e.style.cssText:(this.el&&(this.el.style.cssText=t),this)}cssFloat(t){return parseFloat(this.css(t))}cssInt(t){return parseInt(this.css(t))}px(t,e){return this.css(t,e+"px")}rect(){var t;return null===(t=this.el)||void 0===t?void 0:t.getBoundingClientRect()}isSVG(){var t;return"SVG"===(null===(t=this.el)||void 0===t?void 0:t.tagName.toUpperCase())}offsetRect(){var t,e,i,s,r,o;if(this.isSVG()){const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,top:e.x-t.x,left:e.y-t.y,width:e.width,height:e.height}}return{x:null===(t=this.el)||void 0===t?void 0:t.offsetLeft,y:null===(e=this.el)||void 0===e?void 0:e.offsetTop,top:null===(i=this.el)||void 0===i?void 0:i.offsetTop,left:null===(s=this.el)||void 0===s?void 0:s.offsetLeft,width:null===(r=this.el)||void 0===r?void 0:r.offsetWidth,height:null===(o=this.el)||void 0===o?void 0:o.offsetHeight}}offset(){var t=this.rect(),e=me.getScrollTop(),i=me.getScrollLeft();return{top:t.top+e,left:t.left+i}}offsetLeft(){return this.offset().left}offsetTop(){return this.offset().top}position(){var t;return(null===(t=this.el)||void 0===t?void 0:t.style.top)?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}size(){return[this.width(),this.height()]}width(){var t;return(null===(t=this.el)||void 0===t?void 0:t.offsetWidth)||this.rect().width}contentWidth(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}height(){var t;return(null===(t=this.el)||void 0===t?void 0:t.offsetHeight)||this.rect().height}contentHeight(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}val(t){if(r(t))return this.el.value;if(o(t)){var e=t;t instanceof me&&(e=t.val()),this.el.value=e}return this}matches(t){var e,i;return this.el&&(null===(e=this.el)||void 0===e?void 0:e.matches)?(null===(i=this.el)||void 0===i?void 0:i.matches(t))?this:this.parent().matches(t):null}get value(){return this.el?this.el.value:""}get files(){const t=this.el;return(null==t?void 0:t.files)?[...null==t?void 0:t.files]:[]}show(t="block"){return this.css("display","none"!=t?t:"block")}hide(){return this.css("display","none")}isHide(){return"none"==this.css("display")}isShow(){return!this.isHide()}toggle(t=!1){var e=this.isHide();return 1==arguments.length?t?this.show():this.hide():e?this.show():this.hide()}scrollIntoView(){var t;null===(t=this.el)||void 0===t||t.scrollIntoView()}setScrollTop(t){return this.el&&(this.el.scrollTop=t),this}setScrollLeft(t){return this.el&&(this.el.scrollLeft=t),this}scrollTop(){var t;return this.el===document.body?me.getScrollTop():null===(t=this.el)||void 0===t?void 0:t.scrollTop}scrollLeft(){var t;return this.el===document.body?me.getScrollLeft():null===(t=this.el)||void 0===t?void 0:t.scrollLeft}scrollHeight(){var t;return null===(t=this.el)||void 0===t?void 0:t.scrollHeight}scrollWidth(){var t;return null===(t=this.el)||void 0===t?void 0:t.scrollWidth}on(t,e,i){var s;return null===(s=this.el)||void 0===s||s.addEventListener(t,e,i),this}off(t,e){var i;return null===(i=this.el)||void 0===i||i.removeEventListener(t,e),this}getElement(){return this.el}createChild(t,e="",i={},s={}){let r=me.create(t,e,i);return r.css(s),this.append(r),r}get firstChild(){var t;return me.create(null===(t=this.el)||void 0===t?void 0:t.firstElementChild)}children(){var t,e=null===(t=this.el)||void 0===t?void 0:t.firstElementChild;if(!e)return[];var i=[];do{i.push(me.create(e)),e=e.nextElementSibling}while(e);return i}childLength(){var t;return null===(t=this.el)||void 0===t?void 0:t.children.length}replace(t){var e,i,s;return(null===(e=this.el)||void 0===e?void 0:e.parentNode)&&(t instanceof me?null===(i=this.el)||void 0===i||i.parentNode.replaceChild(t.el,this.el):null===(s=this.el)||void 0===s||s.parentNode.replaceChild(t,this.el)),this}replaceChild(t,e){var i;const s=t instanceof me?t.el:t,r=e instanceof me?e.el:e;return null===(i=this.el)||void 0===i||i.replaceChild(r,s),this}checked(t=!1){return 0==arguments.length?Boolean(this.el.checked):(this.el&&(this.el.checked=Boolean(t)),this)}click(){var t;return null===(t=this.el)||void 0===t||t.click(),this}focus(){var t;return null===(t=this.el)||void 0===t||t.focus(),this}blur(){var t;return null===(t=this.el)||void 0===t||t.blur(),this}select(){return this.el.select(),this}fullscreen(){const t=this.el;(null==t?void 0:t.requestFullscreen)&&t.requestFullscreen()}}const ge={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0,wheel:!0,mousewheel:!0};class ye extends ce{constructor(){super(...arguments),this._domEvents=void 0,this._bindings=[]}initialize(){this.destroy(),this._domEvents||(this._domEvents=this.filterProps(C)),this._domEvents.forEach(t=>this.parseEvent(t))}destroy(){this.removeEventAll()}removeEventAll(){var t;null===(t=this.getBindings())||void 0===t||t.forEach(t=>{this.removeEvent(t)}),this.initBindings()}removeEvent({eventName:t,dom:e,callback:i}){ne(e,t,i)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){var e;null===(e=this.getBindings())||void 0===e||e.push(t)}initBindings(){this._bindings=[]}matchPath(t,e){if(t)return e&&t.matches(e)?t:this.matchPath(t.parentElement,e)}hasDelegate(t,e){return this.matchPath(t.target||t.srcElement,null==e?void 0:e.delegate)}makeCallback(t,e){return t.delegate?this.makeDelegateCallback(t,e):this.makeDefaultCallback(t,e)}makeDefaultCallback(t,e){return i=>{var s=this.runEventCallback(i,t,e);if(o(s))return s}}makeDelegateCallback(t,e){return i=>{const s=this.hasDelegate(i,t);if(s){i.$dt=me.create(s);var r=this.runEventCallback(i,t,e);if(o(r))return r}}}runEventCallback(t,e,i){const s=this.context;if(t.xy=ae(t),e.beforeMethods.length&&e.beforeMethods.every(e=>null==s?void 0:s.getMethod(e.target).call(s,t,e.param)),this.checkEventType(t,e)){var r=i(t,t.$dt,t.xy);return!1!==r&&e.afterMethods.length&&e.afterMethods.forEach(e=>null==s?void 0:s.getMethod(e.target).call(s,t,e.param)),r}}checkEventType(t,e){const i=this.context;var s=!0;e.codes.length&&(s=!!t.code&&e.codes.indexOf(t.code.toLowerCase())>-1||!!t.key&&e.codes.indexOf(t.key.toLowerCase())>-1);var r=!0;return e.checkMethodList.length&&(r=e.checkMethodList.every(e=>{var s=null==i?void 0:i.getMethod(e);return c(s)&&s?s.call(i,t):!o(s)||Boolean(s)})),s&&r}getDefaultDomElement(t){const e=this.context;let i;return i=t?(null==e?void 0:e.refs[t])||(null==e?void 0:e.getMethod(t))||window[t]:null==e?void 0:e.$el,i instanceof me?i.getElement():i}getDefaultEventObject(t,e){const i=this.context;let s=e;const r=s.filter(t=>!!(null==i?void 0:i.getMethod(t))),[o,n]=this.splitMethodByKeyword(s,"after"),[l,a]=this.splitMethodByKeyword(s,"before"),[h,d]=this.splitMethodByKeyword(s,"debounce"),[c,u]=this.splitMethodByKeyword(s,"throttle"),[v]=this.splitMethodByKeyword(s,"capture"),p=[...r,...o,...l,...h,...c,...v];return{eventName:t,codes:s.filter(t=>-1===p.indexOf(t)).map(t=>t.toLowerCase()),captures:v,afterMethods:n,beforeMethods:a,debounceMethods:d,throttleMethods:u,checkMethodList:r}}addEvent(t,e){t.callback=this.makeCallback(t,e),this.addBinding(t);const i=!!t.captures.length;let s=i;ge[t.eventName]&&(s={passive:!0,capture:i}),oe(t.dom,t.eventName,t.callback,s)}bindingEvent([i,s,...r],o,n){let l=this.getDefaultEventObject(i,o);if(l.dom=this.getDefaultDomElement(s),l.delegate=r.join(" "),l.debounceMethods.length)n=t(n,+l.debounceMethods[0].target);else if(l.throttleMethods.length){n=e(n,+l.throttleMethods[0].target)}this.addEvent(l,n)}getEventNames(t){let e=[];return t.split(":").forEach(t=>{var i=t.split(":");e.push(...i)}),e}parseEvent(t){const e=this.context;let i=t.split(S).map(t=>t.trim());var s=i.shift().split("dom ")[1].split(" "),r=this.getEventNames(s[0]),o=null==e?void 0:e.getMethod(t).bind(e);r.forEach(t=>{s[0]=t,this.bindingEvent(s,i,o)})}}class be extends ce{load(...t){this.bindData(...t)}bindData(...t){this._bindMethods||(this._bindMethods=this.filterProps(E)),this._bindMethods.filter(e=>{if(!t.length)return!0;var[i,s]=e.split(S),[r,o]=i.split(" ");return t.indexOf(o)>-1}).forEach(e=>{var s,o;const l=null===(s=this.context)||void 0===s?void 0:s.getMethod(e);var[e,u]=e.split(S);const v=this.getRef(u);let p=se;""!=v&&a(v)?p=()=>{var t,e;return(null===(t=this.context)||void 0===t?void 0:t.prevState[v])!==(null===(e=this.context)||void 0===e?void 0:e.state[v])}:c(v)&&(p=v);const f=e.split("bind ")[1];let m=null===(o=this.context)||void 0===o?void 0:o.refs[f];const g=c(p)&&p.call(this.context);if(m&&g){const e=l.call(this.context,...t);if(!e)return;i(e,(t,e)=>{((t,e,s)=>{var o;"cssText"!==e?"style"!==e?"class"!==e?r(s)?t.removeAttr(e):"TEXTAREA"===(null===(o=null==t?void 0:t.el)||void 0===o?void 0:o.nodeName)&&"value"===e||"text"===e||"textContent"===e?t.text(s):"innerHTML"===e||"html"===e?t.html(s):"value"===e?t.val(s):t.attr(e,s):n(s)?t.addClass(...s):d(s)?i(s,(e,i)=>t.toggleClass(e,i)):t.addClass(s):h(s)&&t.css(s):t.cssText(s)})(m,t,e)})}})}destroy(){this._bindMethods=void 0}}const Ce=me.create("div"),xe={constructor:!0,initState:!0,refresh:!0,updateData:!0,initializeProperty:!0,created:!0,getRealEventName:!0,initializeStoreEvent:!0,destoryStoreEvent:!0,destroy:!0,emit:!0,trigger:!0,on:!0,off:!0,setState:!0,_reload:!0,render:!0,initialize:!0,afterRender:!0,components:!0,getRef:!0,parseTemplate:!0,childrenIds:!0,exists:!0,parseProperty:!0,parseSourceName:!0,parseComponent:!0,clean:!0,loadTemplate:!0,load:!0,bindData:!0,template:!0,eachChildren:!0,initializeEvent:!0,collectProps:!0,filterProps:!0,self:!0,isAltKey:!0,isCtrlKey:!0,isShiftKey:!0,isMetaKey:!0,preventDefault:!0,stopPropagation:!0,bodyMouseMove:!0,bodyMouseUp:!0};const Ee=/^ME@/,Me=(...t)=>t.join("|"),Se=(...t)=>"ME@"+Me(...t);class ke extends class{constructor(t,e){this.opt={},this.props={},this.$store=void 0,this.$root=void 0,this.state={},this.prevState={},this.refs={},this.children={},this.id=g(),this.handlers=this.initializeHandler(),this.childComponents={},this.childComponentKeys=[],this.childComponentSet=new Map,this.childComponentKeysString="",this.sourceName=this.constructor.name,this.initializeProperty(t,e),this.initComponents()}setStore(t){this.$store=t}setRoot(t){this.$root=t}initializeProperty(t,e){}initComponents(){this.childComponents=this.components(),this.childComponentKeys=Object.keys(this.childComponents),this.childComponentSet=new Map,this.childComponentKeys.forEach(t=>{this.childComponentSet.set(t.toLowerCase(),t)}),this.childComponentKeysString=[...this.childComponentSet.keys()].join(",")}initializeHandler(){return[new be(this),new ye(this)]}initState(){return{}}setState(t={},e=!0){this.prevState=this.state,this.state=Object.assign({},this.state,t),e&&this.load()}_reload(t){this.props=t,this.state={},this.setState(this.initState(),!1),this.refresh()}render(t){this.$el=this.parseTemplate(this.template()),this.refs.$el=this.$el,t&&t.append(this.$el),this.load(),this.afterRender()}initialize(){this.state=this.initState()}afterRender(){}components(){return{}}getRef(...t){const e=t.join("");return this.refs[e]}getMethod(t){return this[t]}parseTemplate(t,e=!1){let i="";i=n(t)?t.join(""):t;const s=(null==Ce?void 0:Ce.html(f`${i}`)).children();return s.forEach(t=>{const e=t.attr("ref");e&&(this.refs[e]=t);const i=t.$$("[ref]");let s={};i.forEach(t=>{const i=t.attr("ref");s[i]?console.warn(`${e} is duplicated. - ${this.sourceName}`,this):s[i]=!0,this.refs[i]=t})}),e?Ce.createChildrenFragment():s[0]}childrenIds(){return s(this.children,(t,e)=>e.id)}exists(){return!this.parent||!c(this.parent.childrenIds)||this.parent.childrenIds().indexOf(this.id)>-1}parseProperty(t){var e;let i={};return Object.keys((null===(e=null==t?void 0:t.el)||void 0===e?void 0:e.attributes)||{}).forEach(e=>{var s;const r=(null===(s=null==t?void 0:t.el)||void 0===s?void 0:s.attributes)[e];i[r.nodeName]=r.nodeValue}),t.$$("property").forEach(t=>{const[e,s,r]=t.attrs("name","value","type");let o=s||t.text();"json"===r&&(o=JSON.parse(o)),e&&(i[e]=o)}),i}parseSourceName(t){return t.parent?[t.sourceName,...this.parseSourceName(t.parent)]:[t.sourceName]}parseComponent(){const t=this.$el;let e=[];this.childComponentKeysString&&(e=t.$$(this.childComponentKeysString)),e.forEach(t=>{var e,i=null===(e=null==t?void 0:t.el)||void 0===e?void 0:e.tagName.toLowerCase(),s=this.childComponentSet.get(i),r=this.childComponents[s];let o=this.parseProperty(t),n=t.attr("ref");var l=null;this.children[n]?(l=this.children[n])._reload(o):(l=new r(this,o),this.children[n||l.id]=l,l.render()),t.replace(l.$el)}),i(this.children,(t,e)=>{e&&e.clean()&&delete this.children[t]})}clean(){if(this.$el&&!this.$el.hasParent())return i(this.children,(t,e)=>{e.clean()}),this.destroy(),this.$el=null,!0}refresh(){this.load()}loadTemplate(...t){return this.getMethod(te(t.join(""))).call(this)}load(...t){this._loadMethods||(this._loadMethods=this.filterProps(x)),this._loadMethods.filter(e=>{const i=e.split("load ")[1].split(S)[0];return!t.length||t.indexOf(i)>-1}).forEach(e=>{let i=e.split("load ")[1];var[s,...r]=i.split(S).map(t=>t.trim());r=r.map(t=>t.trim());const o=Boolean(r.filter(t=>qt.includes(t)).length);if(this.refs[s]){var n=this.getMethod(e).call(this,...t);const i=this.parseTemplate(n,!0);o?this.refs[s].htmlDiff(i):this.refs[s].html(i)}}),this.runHandlers("initialize"),this.bindData(),this.parseComponent()}runHandlers(t="run",...e){this.handlers.forEach(i=>i[t](...e))}bindData(...t){this.runHandlers("load",...t)}template(){return"<div></div>"}eachChildren(t){c(t)&&i(this.children,(e,i)=>{t(i)})}rerender(){var t=this.$el.parent();this.destroy(),this.render(t)}destroy(){this.eachChildren(t=>{t.destroy()}),this.runHandlers("destroy"),this.$el.remove(),this.$el=null,this.refs={},this.children={}}collectProps(){var t=this.getMethod("__proto__"),e=[];do{if(!1===t instanceof Object)break;const i=Object.getOwnPropertyNames(t).filter(t=>this&&c(this[t])&&!xe[t]);e.push(...i),t=t.__proto__}while(t);return e}filterProps(t){return this.collectProps().filter(e=>e.match(t))}self(t){return Boolean(t&&t.$dt&&t.$dt.is(t.target))}isAltKey(t){return Boolean(t.altKey)}isCtrlKey(t){return Boolean(t.ctrlKey)}isShiftKey(t){return Boolean(t.shiftKey)}isMetaKey(t){return Boolean(t.metaKey||"Meta"==t.key||t.code.indexOf("Meta")>-1)}preventDefault(t){return t.preventDefault(),!0}stopPropagation(t){return t.stopPropagation(),!0}emit(t,...e){}trigger(t,...e){}bodyMouseMove(t,e){this.getMethod(e)&&this.emit("add/body/mousemove",this.getMethod(e),this,t.xy)}bodyMouseUp(t,e){this.getMethod(e)&&this.emit("add/body/mouseup",this.getMethod(e),this,t.xy)}}{constructor(t,e={}){super(t,e),this.opt={},this.parent=void 0,this.props={},this.source="",this.sourceName="",this.created(),this.initialize(),this.initializeStoreEvent()}initializeProperty(t,e={}){this.opt=t||{},this.parent=this.opt,this.props=e,this.source=g(),this.sourceName=this.constructor.name,t&&t.$store&&(this.$store=t.$store),t&&t.$root&&(this.$root=t.$root)}created(){}getRealEventName(t,e="ME@"){var i=t.indexOf(e);return t.substr(i<0?0:i+e.length)}initializeStoreEvent(){this.filterProps(Ee).forEach(t=>{const e=this.getRealEventName(t,"ME@");var[i,s]=((t,e)=>{const i=t.filter(t=>t.indexOf(e+"(")>-1),s=i.map(t=>{const[i,s]=t.split(e+"(")[1].split(")")[0].trim().split(" ");return{target:i,param:s}});return[i,s]})(e.split("|"),"debounce"),r=0;i.length&&(r=+s[0].target||0),e.split("|").filter(t=>-1===i.indexOf(t)).map(t=>t.trim()).forEach(e=>{var i,s=this[t].bind(this);s.displayName=`${this.sourceName}.${e}`,s.source=this.source,null===(i=this.$store)||void 0===i||i.on(e,s,this,r)})})}destoryStoreEvent(){var t;null===(t=this.$store)||void 0===t||t.offAll(this)}destroy(){super.destroy(),this.destoryStoreEvent()}rerender(){super.rerender(),this.initialize(),this.initializeStoreEvent()}emit(t,...e){var i;this.$store&&(this.$store.source=this.source,this.$store.sourceContext=this,null===(i=this.$store)||void 0===i||i.emit(t,...e))}trigger(t,...e){var i;this.$store&&(this.$store.source=this.source,null===(i=this.$store)||void 0===i||i.trigger(t,...e))}on(t,e){var i;null===(i=this.$store)||void 0===i||i.on(t,e,this)}off(t,e){var i;null===(i=this.$store)||void 0===i||i.off(t,e)}}const we={x:0,y:0},$e={x:Number.MAX_SAFE_INTEGER,y:Number.MAX_SAFE_INTEGER},Ne=e=>{class i extends ke{constructor(){super(...arguments),this.$container=void 0,this.moves=void 0,this.ends=void 0,this.funcBodyMoves=void 0,this.state={},this.requestId=-1}initialize(){this.setStore(new he),this.setRoot(this);const t=this.getContainer();this.$container=me.create(t),this.$container.addClass(this.getClassName()),this.render(this.$container),this.initBodyMoves()}initState(){return{pos:{},oldPos:{}}}initBodyMoves(){this.moves=new Set,this.ends=new Set,this.modifyBodyMoveSecond(0)}modifyBodyMoveSecond(e=0){this.funcBodyMoves=t(this.loopBodyMoves.bind(this),e)}loopBodyMoves(){var t;const{bodyEvent:e,pos:i,lastPos:s}=this.state,r=s||$e;!(r.x===(null==i?void 0:i.x)&&r.y===(null==i?void 0:i.y))&&(null===(t=this.moves)||void 0===t?void 0:t.size)&&(this.moves.forEach(t=>{const s=((null==i?void 0:i.x)||0)-t.xy.x,r=((null==i?void 0:i.y)||0)-t.xy.y;0==s&&0==r||t.func.call(t.context,s,r,"move",e.pressure)}),this.state.lastPos=i),this.funcBodyMoves&&window.requestAnimationFrame(this.funcBodyMoves)}removeBodyMoves(){var t,e,i;const{pos:s,bodyEvent:r}=this.state;s&&(null===(t=this.ends)||void 0===t||t.forEach(t=>{t.func.call(t.context,((null==s?void 0:s.x)||0)-t.xy.x,((null==s?void 0:s.y)||0)-t.xy.y,"end",r.pressure)})),null===(e=this.moves)||void 0===e||e.clear(),null===(i=this.ends)||void 0===i||i.clear()}[Se("add/body/mousemove")](t,e,i){var s;null===(s=this.moves)||void 0===s||s.add({func:t,context:e,xy:i})}[Se("add/body/mouseup")](t,e,i){var s;null===(s=this.ends)||void 0===s||s.add({func:t,context:e,xy:i})}getClassName(){return e.className||"sapa"}getContainer(){return e.container||document.body}template(){return""+e.template}components(){return e.components||{}}[ft("document")](t){var e=this.state.pos||we,i=t.xy||we;this.setState({bodyEvent:t,pos:i,oldPos:e},!1),-1===this.requestId&&this.funcBodyMoves&&(this.requestId=window.requestAnimationFrame(this.funcBodyMoves))}[mt("document")](t){var e=t.xy||we;"INPUT"!==t.target.nodeName&&"SELECT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(this.setState({bodyEvent:t,pos:e},!1),this.removeBodyMoves(),this.requestId=-1)}}return new i(e)};export{$t as AFTER,jt as ALT,Ct as ANIMATIONEND,xt as ANIMATIONITERATION,bt as ANIMATIONSTART,Ot as ARROW_DOWN,Pt as ARROW_LEFT,_t as ARROW_RIGHT,At as ARROW_UP,Nt as BEFORE,re as BIND,se as BIND_CHECK_DEFAULT_FUNCTION,$ as BIND_SAPARATOR,ht as BLUR,Yt as CAPTURE,rt as CHANGE,gt as CHANGEINPUT,wt as CHECKER,E as CHECK_BIND_PATTERN,C as CHECK_DOM_EVENT_PATTERN,x as CHECK_LOAD_PATTERN,S as CHECK_SAPARATOR,P as CLICK,st as CONTEXTMENU,Rt as CONTROL,O as CUSTOM,Ut as D1000,Vt as DEBOUNCE,L as DOM_EVENT_MAKE,k as DOM_EVENT_SAPARATOR,_ as DOUBLECLICK,G as DRAG,it as DRAGEND,Q as DRAGENTER,tt as DRAGEXIT,Z as DRAGLEAVE,et as DRAGOUT,J as DRAGOVER,Y as DRAGSTART,W as DROP,me as Dom,Jt as END,Bt as ENTER,Kt as ESCAPE,Se as EVENT,It as FIT,nt as FOCUS,lt as FOCUSIN,at as FOCUSOUT,Tt as IF,ot as INPUT,Lt as KEY,q as KEYDOWN,U as KEYPRESS,V as KEYUP,te as LOAD,w as LOAD_SAPARATOR,zt as META,B as MOUSEDOWN,z as MOUSEENTER,R as MOUSELEAVE,K as MOUSEMOVE,F as MOUSEOUT,j as MOUSEOVER,D as MOUSEUP,Wt as MOVE,M as NAME_SAPARATOR,Xt as PASSIVE,dt as PASTE,Me as PIPE,mt as POINTEREND,ft as POINTERMOVE,pt as POINTERSTART,Qt as PREVENT,ct as RESIZE,N as SAPARATOR,ut as SCROLL,Ht as SELF,Ft as SHIFT,Dt as SPACE,Zt as STOP,vt as SUBMIT,Gt as THROTTLE,X as TOUCHEND,I as TOUCHMOVE,H as TOUCHSTART,kt as TRANSITIONCANCEL,Mt as TRANSITIONEND,St as TRANSITIONRUN,Et as TRANSITIONSTART,ke as UIElement,qt as VDOM,yt as WHEEL,oe as addEvent,v as clone,ee as createRef,t as debounce,ie as getRef,f as html,n as isArray,l as isBoolean,c as isFunction,h as isNotString,o as isNotUndefined,u as isNumber,d as isObject,a as isString,r as isUndefined,i as keyEach,s as keyMap,b as makeEventChecker,le as pos,ae as posXY,ne as removeEvent,Ne as render,e as throttle,g as uuid,y as uuidShort};
